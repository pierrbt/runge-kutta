#include <stdio.h>
#include <stdlib.h>
#include <math.h>

int main()
{
    int n,i,N;
    float g,cd,m,t,y,dt,k1,k2;
    printf("Combien d'intervales a calculer : ");
    scanf("%d",&N);
    double vitesse_runge[N+1],vitesse_analytique[N+1],erreur[N+1],ti[N+1];
    cd=0.25;
    m=68.1;
    t=0;
    dt=(float)13/N;
    printf("dt = %f\n",dt);
    y=0;
    g=9.81;
    vitesse_runge[0]=0;
    vitesse_analytique[0]=0;
    erreur[0]=0;
    ti[0]=0;
    for (n=1;n<=N;n=n+1){
        k1=g-(cd/m)*y*y;
        k2=g-(cd/m)*(y+dt*k1)*(y+dt*k1);
        y=y+(dt/2)*(k1+k2);
        t=t+dt;
        ti[n]=t;
        vitesse_runge[n]=y;
        vitesse_analytique[n]=51.69*tanh(t/5.27);
        erreur[n]=(vitesse_analytique[n]-vitesse_runge[n])/vitesse_analytique[n];
    }
    printf("Vitesse analytique : ");
    for(i=0;i<=N;i=i+1){
        printf("%lf ; ",vitesse_analytique[i]);
    }
    printf("\n\nVitesse Runge-Kutta : ");
    for(i=0;i<=N;i=i+1){
        printf("%lf ; ",vitesse_runge[i]);
    }
    printf("\n\nErreur : ");
    for(i=0;i<=N;i=i+1){
        printf("%lf ; ",erreur[i]);
    }

    char fileName[] = "data.csv";
    FILE *f = fopen(fileName, "w");
    if (f == NULL)
    {
        printf("Erreur en ouvrant le fichier '%s'\n", fileName);
        fclose(f);
        return 1;
    }
    else
    {
        fprintf(f, "Temps ; Vitesse Analytique ; Vitesse Runge-Kutta ; Erreur\n");
        for(i=0;i<=N;i=i+1){
            fprintf(f, "%lf ; %lf ; %lf ; %lf\n",ti[i],vitesse_analytique[i],vitesse_runge[i],erreur[i]);
        }
    }
    

    

    fclose(f);
    return 0;
}

//macron
//#define N 100
//#define dt (float)13/N
//#define g 9.81
//#define cd 0.25
//#define m 68.1





























































































































































































































































































































































































































































































































































































































































































































































































































































































































































//1000 lignes code
// 1000 lignes de commentaire
// 1000 lignes de code
// 1000 lignes de commentaire
// 1000 lignes de code
// 1000 lignes de commentaire
// 1000 lignes de code
